import sys
import time
from opcua import Client

# Endpoint URL
url = "opc.tcp://MYTSL02946.lnties.com:53530/OPCUA/SimulationServer"

try:
    # Create a client and connect to the OPC UA server
    client = Client(url)
    client.connect()
    print("Connected to OPC UA server")

    # Get the node for random number
    rand_num_node = client.get_node("ns=3;i=1003")

    print("Client created")
    print("Session created")
    print("Value written successfully")
    print("Created")
    print("Subscribed")

    while True:
        # Retrieve the random number value
        random_num_value = rand_num_node.get_value()
        print("Data change from server:")
        print(f"Item \"{rand_num_node.nodeid}\", Value = {random_num_value}")

        # Delay for 1 second before retrieving the next value
        time.sleep(1)

except Exception as err:
    print("Error:", err)
    sys.exit(1)
finally:
    # Disconnect from the OPC UA server
    client.disconnect()
