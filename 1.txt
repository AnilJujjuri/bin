from opcua import Client
from opcua.ua import NodeId, AttributeIds, DataValue, Variant
import time

def main():
    client = Client("opc.tcp://MYTSL02946.lnties.com:53530/OPCUA/SimulationServer")
    client.connect()

    print("Client created")

    # Retrieve the namespace index for the "SimulationServer" namespace
    uri = "http://opcfoundation.org/UA/SimulationServer"
    namespace_index = client.get_namespace_index(uri)

    # Construct the NodeId for the "random" node
    node_id = NodeId(namespace_index, "random")

    value = 20

    try:
        while True:
            # Write the value to the node attribute
            node = client.get_node(node_id)
            data_value = DataValue(Variant(value))
            node.set_attribute(AttributeIds.Value, data_value)

            print("Value written successfully")

            # Read the value from the node
            data_value = node.get_value()
            if data_value is not None:
                print(f"Item \"{node_id}\", Value = {data_value.Value.VariantType}")
            else:
                print(f"Item \"{node_id}\", Value not found")

            # Increment the value for the next iteration
            value += 1

            # Wait for some time before the next iteration
            time.sleep(2)

    except KeyboardInterrupt:
        pass

    client.disconnect()

if __name__ == '__main__':
    main()
