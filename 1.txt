import can
import csv

def write_to_csv(csv_file, can_id, can_data):
    file_exists = False
    if not file_exists:
        with open(csv_file, 'w', newline='') as file:
            writer = csv.writer(file)
            writer.writerow(["CAN ID", "CAN Data"])
    with open(csv_file, 'a', newline='') as file:
        writer = csv.writer(file)
        writer.writerow([can_id] + can_data)

def receive_can_messages(bus, csv_file):
    while True:
        message = bus.recv()
        can_id = message.arbitration_id
        can_data = list(message.data)
        write_to_csv(csv_file, can_id, can_data)

def main():
    bus = can.interface.Bus(channel='vcan0', bustype='socketcan')
    csv_file = "can_data.csv"

    print("Starting CAN Data Logger...")
    receive_can_messages(bus, csv_file)

if __name__ == '__main__':
    main()
