from azure.iot.device import IoTHubDeviceClient, Message
import os
import json

def send_twin_update(client, properties):
    twin_patch = {"properties": {"reported": properties}}
    twin_patch_json = json.dumps(twin_patch)
    twin_message = Message(twin_patch_json)
    twin_message.content_encoding = "utf-8"
    twin_message.content_type = "application/json"
    client.send_message(twin_message)

def main():
    device_connection_string = os.getenv("DEVICE_CONNECTION_STRING")  # Read from environment variable
    client = IoTHubDeviceClient.create_from_connection_string(device_connection_string)

    client.connect()

    # Sample data to insert
    properties = {
        "temperature": 25.5,
        "humidity": 70.2,
        "pressure": 1013.25,
        "status": "active"
    }

    send_twin_update(client, properties)

    client.disconnect()

if __name__ == '__main__':
    main()
