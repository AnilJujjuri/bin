import minimalmodbus
import random
import time

# Modbus RTU Configuration
modbus_port = 'COM2'  # Replace with the appropriate COM port for Modbus RTU
modbus_slave_address = 1  # Replace with the Modbus slave device address
modbus_register_address = 0  # Replace with the register address to write random data

def write_modbus_data():
    instrument = minimalmodbus.Instrument(modbus_port, modbus_slave_address)
    instrument.serial.baudrate = 9600  # Set the baud rate to match your Modbus setup
    instrument.serial.timeout = 0.2  # Set the timeout as required

    # Generate random data (for example, a random integer between 0 and 100)
    random_data = random.randint(0, 100)

    # Write random data to the Modbus register
    instrument.write_register(modbus_register_address, random_data)

while True:
    try:
        # Write random data to diagslave
        write_modbus_data()

        # Adjust the polling rate as needed
        time.sleep(1)

    except KeyboardInterrupt:
        break
