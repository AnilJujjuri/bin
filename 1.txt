from azure.iot.device import IoTHubDeviceClient

def update_device_twin(device_connection_string, can_device_id, telemetry_data):
    client = IoTHubDeviceClient.create_from_connection_string(device_connection_string)
    client.connect()

    twin_patch = {
        "reported": {
            can_device_id: telemetry_data
        }
    }
    client.patch_twin_reported_properties(twin_patch)

    client.disconnect()

if __name__ == '__main__':
    device_connection_string = "HostName=EDGTneerTrainingPractice.azure-devices.net;DeviceId=nodered;SharedAccessKey=mOeGufRBpvjmFut51ghJ0gjmWZDR8BHN1WWJtdsrBY4="
    can_device_id = "1001"
    telemetry_data = {
        "temperature": 25.5,
        "pressure": 1013.25,
        "humidity": 50
    }
    update_device_twin(device_connection_string, can_device_id, telemetry_data)
