from azure.iot.device import IoTHubModuleClient, Message

def main():
    try:
        # Initialize the IoT Hub module client
        client = IoTHubModuleClient.create_from_edge_environment()
        
        # Check the connection status
        if client.connected:
            print("Client is connected to IoT Hub.")
        else:
            print("Client is not connected to IoT Hub.")
            return  # Exit if not connected
        
        # Create a test message
        message = Message("Test message from IoT Edge module")
        
        # Publish the test message to an output (replace with your output name)
        try:
            client.send_message_to_output(message, "outputName")
            print("Message sent successfully.")
        except Exception as e:
            print("Error sending message:", e)
        
        # Fetch the module twin
        twin = client.get_twin()
        print("Module Twin:", twin)
        
    except Exception as e:
        print("Error:", e)

if __name__ == "__main__":
    main()
