from azure.iot.device import IoTHubDeviceClient

device_connection_string = "HostName=<your-iothub-hostname>;DeviceId=<your-device-id>;SharedAccessKey=<your-shared-access-key>"

# Create an instance of the IoTHubDeviceClient
client = IoTHubDeviceClient.create_from_connection_string(device_connection_string)

# Connect to the IoT Hub
client.connect()

# Define the desired properties patch to simulate
patch = {
    "desired": {
        "can_device_id": "my_can_device",
        "my_can_device": {
            "telemetry1": 42,
            "telemetry2": 3.14,
            "telemetry3": "value"
        }
    }
}

# Pass the patch to the handle_device_twin_update function
can_controller = CanController(bus)  # Create an instance of the CanController
handle_device_twin_update(patch, can_controller)

# Disconnect from the IoT Hub
client.disconnect()
