import sys

from opcua import Client

# Define the Prosys Simulator URL

prosys_simulator_url = "opc.tcp://HYTSL00827:53530/OPCUA/SimulationServer"

                        # ["opc.tcp://localhost:53530/OPCUA/SimulationServer"
 # Discover OPC UA servers on the specified URL

def discover_server(server_url):

    try:
        client = Client(server_url)
        client.connect()
        server_name = client.get_endpoints()[0].Server.ApplicationName.Text
        client.disconnect()
        return {"url": server_url, "name": server_name}
    except Exception as e:
        pass  # Server not found or connection failed
    return None

# Main function 

def main():

    # Discover the Prosys OPC UA Simulator
    prosys_server = discover_server(prosys_simulator_url)

    if prosys_server:

        print("Discovered Prosys OPC UA Server:")

        print(f"Server URL: {prosys_server['url']}, Server Name: {prosys_server['name']}") 

        try:
            # Connect to the Prosys OPC UA Serveer
            client = Client(prosys_server['url'])
            client.connect()
            print("Connected to Prosys OPC UA Server")
            node = client.get_node("ns=3;i=1003")  # Replace with the NodeId you want to read
            value = node.get_value()
            print("Node Value:", value)
            client.disconnect()

        except Exception as e:
            print("Error connecting to Prosys OPC UA Server:", str(e))
    else:
       print("Prosys OPC UA Server not found.")

if __name__ == "__main__":
    main()
