from opcua import Client

def main():
    client = Client("opc.tcp://MYTSL02946.lnties.com:53530/OPCUA/SimulationServer")
    client.set_security_string("None")

    print("Client created")

    client.connect()
    print("Session created")

    subscription = client.create_subscription(2000, None, None, 10)
    print("Subscription created")

    def data_change_notification(node, val, data):
        print("Data change from server:")
        print(f"Node: {node}")
        print(f"Value: {val}")

    items_to_monitor = [
        client.get_node("ns=3;i=1003"),
        client.get_node("ns=3;i=1008"),
        client.get_node("ns=3;i=1009"),
        client.get_node("ns=3;i=1010")
    ]
    monitored_items = subscription.subscribe_data_change(items_to_monitor, data_change_notification)
    print("Monitored items created")

    node_to_write = client.get_node("ns=3;i=1012")
    node_to_write.set_value(20)
    print("Value written successfully")

    print("Subscribed")

    # Keep the client running to receive data change notifications
    try:
        while True:
            pass
    except KeyboardInterrupt:
        pass

    client.disconnect()

if __name__ == "__main__":
    main()
