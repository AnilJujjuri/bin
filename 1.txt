from opcua import Client
from opcua import ua

def main():
    client = Client("opc.tcp://MYTSL02946.lnties.com:53530/OPCUA/SimulationServer")

    print("Client created")

    client.connect()
    print("Session created")

    subscription = client.create_subscription(2000, None)
    print("Subscription created")

    def data_change_notification(sub, mon, data):
        print("Data change from server:")
        for val in data.MonitoredItems:
            print(f"Node: {val.NodeId}")
            print(f"Value: {val.Value.Value}")

    items_to_monitor = [
        ("ns=3;i=1003", ua.ObjectIds.BaseDataVariableType),
        ("ns=3;i=1008", ua.ObjectIds.BaseDataVariableType),
        ("ns=3;i=1009", ua.ObjectIds.BaseDataVariableType),
        ("ns=3;i=1010", ua.ObjectIds.BaseDataVariableType)
    ]
    monitored_items = subscription.subscribe_data_change(items_to_monitor, data_change_notification)
    print("Monitored items created")

    node_to_write = client.get_node("ns=3;i=1012")
    node_to_write.set_value(ua.Variant(20, ua.VariantType.Int16))
    print("Value written successfully")

    print("Subscribed")

    # Keep the client running to receive data change notifications
    try:
        while True:
            pass
    except KeyboardInterrupt:
        pass

    client.disconnect()

if __name__ == "__main__":
    main()

a
