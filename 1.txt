def receive_can_message(bus):
    while True:
        message = bus.recv()
        can_id = message.arbitration_id
        can_data = message.data
        timestamp = time.time()

        data = {'Timestamp': timestamp, 'CAN_ID': can_id, 'CAN_Data': can_data.hex()}
        df = pd.DataFrame(data, index=[0])

        # Append the data to the CSV file or create a new file if it doesn't exist
        with open('received_can_messages.csv', 'a+', newline='') as csvfile:
            df.to_csv(csvfile, header=csvfile.tell() == 0, index=False, mode='a+')
