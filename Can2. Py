from azure.iot.device import IoTHubDeviceClient

# Azure IoT Hub connection string
device_connection_string = "HostName=EDGTneerTrainingPractice.azure-devices.net;DeviceId=nodered;SharedAccessKey=mOeGufRBpvjmFut51ghJ0gjmWZDR8BHN1WWJtdsrBY4="

def set_desired_properties(properties):
    # Create the IoT Hub device client
    client = IoTHubDeviceClient.create_from_connection_string(device_connection_string)

    # Connect to the IoT Hub
    client.connect()

    # Set the desired properties
    twin_patch = {
        "properties": {
            "desired": properties
        }
    }
    client.patch_twin_reported_properties(twin_patch)

    # Disconnect from the IoT Hub
    client.disconnect()

# Example desired properties
desired_properties = {
    "can_id": 123,
    "baudrate": 500000,
    "bit_timing": "Standard",
    "message_filtering": True,
    "error_handling": "Automatic"
}

# Set the desired properties in the IoT Hub
set_desired_properties(desired_properties)
