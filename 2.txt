def collect_and_send_data(client):
    try:
        energy_consumption_address = 0x0000
        energy_consumption_value = client.read_holding_registers(energy_consumption_address, count=1, unit=0).registers[0]

        voltage_address = 0x0001
        voltage_value = client.read_holding_registers(voltage_address, count=1, unit=0).registers[0]

        current_address = 0x0002
        current_value = client.read_holding_registers(current_address, count=1, unit=0).registers[0]

        power_factor_address = 0x0003
        power_factor_value = client.read_holding_registers(power_factor_address, count=1, unit=0).registers[0]
        
        telemetry = {
            "properties": {
                "energy_consumption": energy_consumption_value,
                "voltage": voltage_value,
                "current": current_value,
                "power": power_factor_value
            }
        }
        time.sleep(1)
        send_to_iothub(telemetry)
        
    except Exception as e:
        print("An error has occurred:", e)
