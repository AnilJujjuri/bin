import random
import time
from azure.iot.device import IoTHubModuleClient
def send_to_iothub(data):
    try:
        CONNECTION_STRING = "HostName=EDGTneerTrainingPractice.azure-devices.net;DeviceId=energydevicemeter;SharedAccessKey=QWn2PcGnFhkYFvwgmhRVnSMaqtiIVHd41s1ISUQhUFs=s"
        module_client = IoTHubModuleClient.create_from_connection_string(CONNECTION_STRING)
        module_client.connect()
        print("connected")
        module_client.patch_twin_reported_properties(data)
        print(data)
        module_client.disconnect()
    except Exception as e:
        print("Error sending data to IoT Hub:", str(e))

if __name__ == "__main__":
    while True:
        data=random.randint(1,100)
        print(data)
        send_to_iothub(data)


